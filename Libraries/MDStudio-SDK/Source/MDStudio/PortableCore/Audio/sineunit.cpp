//
//  sineunit.cpp
//  MDStudio
//
//  Created by Daniel Cliche on 2016-08-12.
//  Copyright Â© 2016-2020 Daniel Cliche. All rights reserved.
//

#include "sineunit.h"

#include <math.h>
#include <mixer.h>

#define GRAPH_SAMPLE_RATE 44100
#define SINE_RATE_FOR_PITCH(_base_pitch_, _pitch_) exp2f((float)(_pitch_ - _base_pitch_) / 12.0f)

using namespace MDStudio;

static float g_sineData[1024] = {0,
                                 0.006141882505979085,
                                 0.0122835333212547,
                                 0.01842472076386345,
                                 0.0245652131693218,
                                 0.03070477889936514,
                                 0.03684318635068592,
                                 0.04298020396367041,
                                 0.04911560023113388,
                                 0.05524914370705371,
                                 0.06138060301530032,
                                 0.0675097468583653,
                                 0.07363634402608675,
                                 0.07976016340437117,
                                 0.08588097398391183,
                                 0.09199854486890317,
                                 0.09811264528575084,
                                 0.1042230445917772,
                                 0.1103295122839221,
                                 0.1164318180074376,
                                 0.1225297315645782,
                                 0.1286230229232847,
                                 0.134711462225861,
                                 0.1407948197976457,
                                 0.1468728661556759,
                                 0.152945372017344,
                                 0.159012108309047,
                                 0.1650728461748278,
                                 0.1711273569850085,
                                 0.1771754123448147,
                                 0.1832167841029916,
                                 0.1892512443604102,
                                 0.1952785654786649,
                                 0.2012985200886601,
                                 0.2073108810991877,
                                 0.2133154217054936,
                                 0.2193119153978331,
                                 0.2253001359700163,
                                 0.2312798575279405,
                                 0.237250854498112,
                                 0.2432129016361556,
                                 0.2491657740353111,
                                 0.2551092471349177,
                                 0.2610430967288853,
                                 0.2669670989741517,
                                 0.2728810303991271,
                                 0.2787846679121244,
                                 0.2846777888097739,
                                 0.2905601707854255,
                                 0.2964315919375339,
                                 0.3022918307780302,
                                 0.3081406662406763,
                                 0.3139778776894048,
                                 0.3198032449266417,
                                 0.3256165482016133,
                                 0.3314175682186357,
                                 0.3372060861453871,
                                 0.342981883621163,
                                 0.3487447427651136,
                                 0.3544944461844626,
                                 0.3602307769827083,
                                 0.3659535187678052,
                                 0.3716624556603275,
                                 0.377357372301612,
                                 0.3830380538618828,
                                 0.3887042860483551,
                                 0.3943558551133186,
                                 0.3999925478622013,
                                 0.4056141516616117,
                                 0.4112204544473596,
                                 0.4168112447324564,
                                 0.4223863116150925,
                                 0.4279454447865937,
                                 0.4334884345393541,
                                 0.4390150717747474,
                                 0.4445251480110144,
                                 0.4500184553911281,
                                 0.455494786690634,
                                 0.4609539353254676,
                                 0.4663956953597476,
                                 0.4718198615135439,
                                 0.477226229170622,
                                 0.4826145943861612,
                                 0.4879847538944486,
                                 0.4933365051165462,
                                 0.4986696461679335,
                                 0.5039839758661226,
                                 0.5092792937382481,
                                 0.5145554000286288,
                                 0.5198120957063036,
                                 0.5250491824725396,
                                 0.530266462768312,
                                 0.5354637397817574,
                                 0.5406408174555976,
                                 0.5457975004945353,
                                 0.5509335943726221,
                                 0.5560489053405959,
                                 0.5611432404331897,
                                 0.5662164074764112,
                                 0.5712682150947923,
                                 0.5762984727186076,
                                 0.5813069905910642,
                                 0.5862935797754594,
                                 0.5912580521623079,
                                 0.5962002204764384,
                                 0.6011198982840574,
                                 0.606016899999783,
                                 0.6108910408936447,
                                 0.615742137098053,
                                 0.6205700056147349,
                                 0.6253744643216368,
                                 0.6301553319797957,
                                 0.6349124282401752,
                                 0.6396455736504696,
                                 0.6443545896618722,
                                 0.649039298635812,
                                 0.6536995238506542,
                                 0.6583350895083666,
                                 0.6629458207411514,
                                 0.6675315436180417,
                                 0.6720920851514627,
                                 0.6766272733037574,
                                 0.6811369369936762,
                                 0.6856209061028309,
                                 0.6900790114821119,
                                 0.6945110849580691,
                                 0.6989169593392559,
                                 0.7032964684225358,
                                 0.7076494469993528,
                                 0.7119757308619634,
                                 0.7162751568096305,
                                 0.7205475626547801,
                                 0.7247927872291199,
                                 0.7290106703897186,
                                 0.7332010530250472,
                                 0.7373637770609811,
                                 0.7414986854667631,
                                 0.7456056222609273,
                                 0.7496844325171828,
                                 0.7537349623702584,
                                 0.7577570590217066,
                                 0.7617505707456682,
                                 0.7657153468945948,
                                 0.7696512379049323,
                                 0.7735580953027633,
                                 0.7774357717094076,
                                 0.7812841208469813,
                                 0.7851029975439157,
                                 0.7888922577404331,
                                 0.7926517584939814,
                                 0.7963813579846259,
                                 0.8000809155204001,
                                 0.803750291542612,
                                 0.8073893476311094,
                                 0.8109979465095011,
                                 0.8145759520503356,
                                 0.8181232292802364,
                                 0.8216396443849932,
                                 0.8251250647146099,
                                 0.8285793587883091,
                                 0.8320023962994912,
                                 0.8353940481206505,
                                 0.8387541863082459,
                                 0.8420826841075276,
                                 0.8453794159573185,
                                 0.8486442574947509,
                                 0.8518770855599579,
                                 0.8550777782007192,
                                 0.8582462146770613,
                                 0.8613822754658129,
                                 0.864485842265113,
                                 0.867556797998874,
                                 0.8705950268211977,
                                 0.873600414120746,
                                 0.876572846525064,
                                 0.8795122119048566,
                                 0.8824183993782191,
                                 0.8852912993148189,
                                 0.8881308033400321,
                                 0.8909368043390312,
                                 0.893709196460826,
                                 0.8964478751222563,
                                 0.8991527370119378,
                                 0.9018236800941583,
                                 0.9044606036127277,
                                 0.9070634080947786,
                                 0.9096319953545183,
                                 0.9121662684969333,
                                 0.914666131921444,
                                 0.9171314913255112,
                                 0.9195622537081937,
                                 0.921958327373656,
                                 0.9243196219346282,
                                 0.926646048315815,
                                 0.9289375187572561,
                                 0.9311939468176365,
                                 0.9334152473775483,
                                 0.9356013366427004,
                                 0.9377521321470804,
                                 0.9398675527560649,
                                 0.9419475186694806,
                                 0.9439919514246141,
                                 0.9460007738991725,
                                 0.9479739103141916,
                                 0.9499112862368959,
                                 0.951812828583505,
                                 0.9536784656219918,
                                 0.9555081269747874,
                                 0.9573017436214368,
                                 0.9590592479012021,
                                 0.9607805735156149,
                                 0.9624656555309772,
                                 0.9641144303808117,
                                 0.9657268358682582,
                                 0.9673028111684215,
                                 0.9688422968306648,
                                 0.9703452347808526,
                                 0.9718115683235417,
                                 0.9732412421441198,
                                 0.9746342023108919,
                                 0.9759903962771153,
                                 0.9773097728829812,
                                 0.9785922823575449,
                                 0.9798378763206036,
                                 0.9810465077845208,
                                 0.9822181311559995,
                                 0.9833527022378016,
                                 0.9844501782304154,
                                 0.98551051773367,
                                 0.9865336807482974,
                                 0.9875196286774409,
                                 0.9884683243281114,
                                 0.9893797319125902,
                                 0.9902538170497794,
                                 0.9910905467664985,
                                 0.9918898894987285,
                                 0.9926518150928021,
                                 0.9933762948065421,
                                 0.9940633013103448,
                                 0.9947128086882113,
                                 0.9953247924387252,
                                 0.9958992294759764,
                                 0.996436098130433,
                                 0.9969353781497574,
                                 0.9973970506995714,
                                 0.997821098364166,
                                 0.9982075051471587,
                                 0.998556256472097,
                                 0.998867339183008,
                                 0.9991407415448946,
                                 0.9993764532441789,
                                 0.9995744653890902,
                                 0.9997347705100013,
                                 0.9998573625597098,
                                 0.9999422369136666,
                                 0.9999893903701498,
                                 0.999998821150386,
                                 0.9999705288986172,
                                 0.9999045146821139,
                                 0.9998007809911359,
                                 0.9996593317388369,
                                 0.9994801722611178,
                                 0.9992633093164256,
                                 0.9990087510854974,
                                 0.9987165071710528,
                                 0.9983865885974316,
                                 0.9980190078101772,
                                 0.9976137786755678,
                                 0.997170916480093,
                                 0.9966904379298773,
                                 0.9961723611500499,
                                 0.9956167056840606,
                                 0.9950234924929431,
                                 0.994392743954524,
                                 0.9937244838625787,
                                 0.9930187374259336,
                                 0.9922755312675157,
                                 0.9914948934233476,
                                 0.9906768533414904,
                                 0.9898214418809328,
                                 0.9889286913104265,
                                 0.9879986353072698,
                                 0.9870313089560363,
                                 0.986026748747252,
                                 0.9849849925760185,
                                 0.9839060797405833,
                                 0.982790050940858,
                                 0.9816369482768823,
                                 0.9804468152472362,
                                 0.9792196967473991,
                                 0.9779556390680557,
                                 0.9766546898933508,
                                 0.9753168982990894,
                                 0.9739423147508863,
                                 0.9725309911022617,
                                 0.9710829805926857,
                                 0.9695983378455693,
                                 0.9680771188662043,
                                 0.9665193810396508,
                                 0.964925183128572,
                                 0.9632945852710174,
                                 0.9616276489781548,
                                 0.9599244371319495,
                                 0.9581850139827921,
                                 0.9564094451470752,
                                 0.9545977976047176,
                                 0.9527501396966384,
                                 0.9508665411221777,
                                 0.9489470729364691,
                                 0.9469918075477574,
                                 0.9450008187146686,
                                 0.9429741815434264,
                                 0.9409119724850202,
                                 0.9388142693323197,
                                 0.9366811512171416,
                                 0.9345126986072634,
                                 0.932308993303389,
                                 0.9300701184360619,
                                 0.9277961584625302,
                                 0.9254871991635596,
                                 0.9231433276401985,
                                 0.9207646323104914,
                                 0.9183512029061445,
                                 0.9159031304691395,
                                 0.9134205073483003,
                                 0.9109034271958085,
                                 0.9083519849636714,
                                 0.9057662769001396,
                                 0.9031464005460758,
                                 0.9004924547312763,
                                 0.8978045395707416,
                                 0.8950827564609014,
                                 0.892327208075788,
                                 0.8895379983631637,
                                 0.8867152325405996,
                                 0.8838590170915072,
                                 0.88096945976112,
                                 0.8780466695524302,
                                 0.8750907567220761,
                                 0.872101832776184,
                                 0.8690800104661602,
                                 0.8660254037844388,
                                 0.8629381279601812,
                                 0.8598182994549293,
                                 0.8566660359582128,
                                 0.8534814563831084,
                                 0.850264680861755,
                                 0.8470158307408212,
                                 0.8437350285769293,
                                 0.8404223981320298,
                                 0.8370780643687344,
                                 0.8337021534456012,
                                 0.8302947927123765,
                                 0.8268561107051895,
                                 0.8233862371417048,
                                 0.8198853029162276,
                                 0.8163534400947683,
                                 0.8127907819100577,
                                 0.8091974627565232,
                                 0.8055736181852173,
                                 0.801919384898707,
                                 0.7982349007459133,
                                 0.7945203047169139,
                                 0.7907757369376986,
                                 0.7870013386648845,
                                 0.7831972522803862,
                                 0.7793636212860452,
                                 0.7755005902982164,
                                 0.7716083050423137,
                                 0.7676869123473113,
                                 0.7637365601402056,
                                 0.7597573974404348,
                                 0.7557495743542584,
                                 0.7517132420690926,
                                 0.7476485528478092,
                                 0.74355566002299,
                                 0.7394347179911447,
                                 0.7352858822068846,
                                 0.7311093091770591,
                                 0.7269051564548515,
                                 0.7226735826338374,
                                 0.7184147473419993,
                                 0.7141288112357065,
                                 0.7098159359936542,
                                 0.7054762843107656,
                                 0.7011100198920528,
                                 0.6967173074464422,
                                 0.6922983126805615,
                                 0.6878532022924878,
                                 0.6833821439654609,
                                 0.6788853063615556,
                                 0.6743628591153208,
                                 0.6698149728273793,
                                 0.6652418190579943,
                                 0.6606435703205946,
                                 0.6560204000752692,
                                 0.6513724827222223,
                                 0.6466999935951963,
                                 0.6420031089548556,
                                 0.6372820059821387,
                                 0.6325368627715737,
                                 0.6277678583245616,
                                 0.6229751725426214,
                                 0.6181589862206054,
                                 0.6133194810398783,
                                 0.6084568395614648,
                                 0.6035712452191607,
                                 0.5986628823126152,
                                 0.5937319360003773,
                                 0.5887785922929124,
                                 0.5838030380455836,
                                 0.5788054609516045,
                                 0.5737860495349573,
                                 0.5687449931432838,
                                 0.5636824819407391,
                                 0.5585987069008207,
                                 0.5534938597991627,
                                 0.5483681332063034,
                                 0.5432217204804189,
                                 0.5380548157600299,
                                 0.5328676139566779,
                                 0.527660310747574,
                                 0.5224331025682151,
                                 0.5171861866049748,
                                 0.5119197607876653,
                                 0.5066340237820709,
                                 0.5013291749824526,
                                 0.4960054145040273,
                                 0.4906629431754188,
                                 0.485301962531081,
                                 0.4799226748036977,
                                 0.4745252829165508,
                                 0.4691099904758671,
                                 0.4636770017631372,
                                 0.4582265217274105,
                                 0.4527587559775619,
                                 0.4472739107745369,
                                 0.4417721930235701,
                                 0.4362538102663818,
                                 0.4307189706733464,
                                 0.425167883035641,
                                 0.4196007567573689,
                                 0.4140178018476611,
                                 0.4084192289127522,
                                 0.4028052491480372,
                                 0.3971760743301038,
                                 0.3915319168087448,
                                 0.3858729894989457,
                                 0.3801995058728541,
                                 0.3745116799517264,
                                 0.3688097262978555,
                                 0.3630938600064748,
                                 0.3573642966976455,
                                 0.351621252508122,
                                 0.3458649440832005,
                                 0.3400955885685433,
                                 0.3343134036019898,
                                 0.3285186073053452,
                                 0.3227114182761542,
                                 0.3168920555794523,
                                 0.3110607387395035,
                                 0.3052176877315184,
                                 0.299363122973358,
                                 0.2934972653172159,
                                 0.2876203360412891,
                                 0.2817325568414296,
                                 0.2758341498227834,
                                 0.269925337491409,
                                 0.264006342745886,
                                 0.2580773888689052,
                                 0.2521386995188482,
                                 0.2461904987213469,
                                 0.2402330108608349,
                                 0.2342664606720825,
                                 0.2282910732317182,
                                 0.2223070739497403,
                                 0.2163146885610109,
                                 0.2103141431167422,
                                 0.2043056639759686,
                                 0.198289477797009,
                                 0.1922658115289143,
                                 0.1862348924029077,
                                 0.1801969479238124,
                                 0.1741522058614704,
                                 0.1681008942421484,
                                 0.1620432413399374,
                                 0.1559794756681407,
                                 0.1499098259706553,
                                 0.1438345212133405,
                                 0.1377537905753822,
                                 0.1316678634406469,
                                 0.1255769693890302,
                                 0.1194813381877937,
                                 0.1133811997828994,
                                 0.1072767842903345,
                                 0.1011683219874323,
                                 0.09505604330418288,
                                 0.08894017881454251,
                                 0.08282095922773459,
                                 0.07669861537954845,
                                 0.07057337822362882,
                                 0.06444547882276536,
                                 0.05831514834017538,
                                 0.05218261803078535,
                                 0.0460481192325047,
                                 0.03991188335750071,
                                 0.03377414188346813,
                                 0.02763512634489885,
                                 0.02149506832434506,
                                 0.01535419944368505,
                                 0.009212751355384765,
                                 0.003070955733761002,
                                 -0.003070955733760757,
                                 -0.009212751355384519,
                                 -0.01535419944368436,
                                 -0.02149506832434482,
                                 -0.0276351263448986,
                                 -0.03377414188346788,
                                 -0.03991188335750002,
                                 -0.04604811923250445,
                                 -0.0521826180307851,
                                 -0.05831514834017513,
                                 -0.06444547882276466,
                                 -0.07057337822362857,
                                 -0.0766986153795482,
                                 -0.08282095922773434,
                                 -0.08894017881454182,
                                 -0.09505604330418263,
                                 -0.101168321987432,
                                 -0.1072767842903343,
                                 -0.1133811997828987,
                                 -0.1194813381877934,
                                 -0.1255769693890299,
                                 -0.1316678634406467,
                                 -0.1377537905753815,
                                 -0.1438345212133403,
                                 -0.1499098259706551,
                                 -0.1559794756681405,
                                 -0.1620432413399368,
                                 -0.1681008942421482,
                                 -0.1741522058614702,
                                 -0.1801969479238122,
                                 -0.1862348924029071,
                                 -0.192265811528914,
                                 -0.1982894777970088,
                                 -0.2043056639759684,
                                 -0.2103141431167416,
                                 -0.2163146885610106,
                                 -0.2223070739497401,
                                 -0.228291073231718,
                                 -0.2342664606720818,
                                 -0.2402330108608347,
                                 -0.2461904987213467,
                                 -0.2521386995188479,
                                 -0.258077388868905,
                                 -0.2640063427458853,
                                 -0.2699253374914088,
                                 -0.2758341498227832,
                                 -0.2817325568414294,
                                 -0.2876203360412884,
                                 -0.2934972653172157,
                                 -0.2993631229733578,
                                 -0.3052176877315182,
                                 -0.3110607387395029,
                                 -0.3168920555794521,
                                 -0.322711418276154,
                                 -0.328518607305345,
                                 -0.3343134036019891,
                                 -0.3400955885685431,
                                 -0.3458649440832003,
                                 -0.3516212525081218,
                                 -0.3573642966976449,
                                 -0.3630938600064745,
                                 -0.3688097262978552,
                                 -0.3745116799517261,
                                 -0.3801995058728534,
                                 -0.3858729894989454,
                                 -0.3915319168087446,
                                 -0.3971760743301035,
                                 -0.4028052491480366,
                                 -0.408419228912752,
                                 -0.4140178018476608,
                                 -0.4196007567573687,
                                 -0.4251678830356404,
                                 -0.4307189706733461,
                                 -0.4362538102663815,
                                 -0.4417721930235698,
                                 -0.4472739107745363,
                                 -0.4527587559775617,
                                 -0.4582265217274103,
                                 -0.463677001763137,
                                 -0.4691099904758665,
                                 -0.4745252829165506,
                                 -0.4799226748036975,
                                 -0.4853019625310809,
                                 -0.4906629431754182,
                                 -0.4960054145040271,
                                 -0.5013291749824524,
                                 -0.5066340237820707,
                                 -0.5119197607876651,
                                 -0.5171861866049743,
                                 -0.5224331025682148,
                                 -0.5276603107475738,
                                 -0.5328676139566777,
                                 -0.5380548157600293,
                                 -0.5432217204804187,
                                 -0.5483681332063033,
                                 -0.5534938597991624,
                                 -0.5585987069008201,
                                 -0.5636824819407389,
                                 -0.5687449931432835,
                                 -0.5737860495349572,
                                 -0.5788054609516039,
                                 -0.5838030380455834,
                                 -0.5887785922929122,
                                 -0.5937319360003771,
                                 -0.5986628823126148,
                                 -0.6035712452191606,
                                 -0.6084568395614646,
                                 -0.6133194810398781,
                                 -0.6181589862206049,
                                 -0.6229751725426212,
                                 -0.6277678583245614,
                                 -0.6325368627715735,
                                 -0.6372820059821381,
                                 -0.6420031089548554,
                                 -0.646699993595196,
                                 -0.651372482722222,
                                 -0.6560204000752686,
                                 -0.6606435703205945,
                                 -0.6652418190579942,
                                 -0.6698149728273792,
                                 -0.6743628591153203,
                                 -0.6788853063615554,
                                 -0.6833821439654607,
                                 -0.6878532022924877,
                                 -0.6922983126805611,
                                 -0.6967173074464421,
                                 -0.7011100198920526,
                                 -0.7054762843107654,
                                 -0.709815935993654,
                                 -0.7141288112357058,
                                 -0.7184147473419991,
                                 -0.7226735826338372,
                                 -0.7269051564548512,
                                 -0.7311093091770584,
                                 -0.7352858822068844,
                                 -0.7394347179911446,
                                 -0.7435556600229898,
                                 -0.7476485528478087,
                                 -0.7517132420690924,
                                 -0.7557495743542582,
                                 -0.7597573974404349,
                                 -0.7637365601402054,
                                 -0.767686912347311,
                                 -0.7716083050423135,
                                 -0.7755005902982162,
                                 -0.7793636212860446,
                                 -0.7831972522803857,
                                 -0.7870013386648841,
                                 -0.7907757369376986,
                                 -0.7945203047169137,
                                 -0.7982349007459131,
                                 -0.8019193848987067,
                                 -0.8055736181852172,
                                 -0.8091974627565227,
                                 -0.8127907819100573,
                                 -0.8163534400947678,
                                 -0.8198853029162277,
                                 -0.8233862371417046,
                                 -0.8268561107051893,
                                 -0.8302947927123763,
                                 -0.8337021534456009,
                                 -0.837078064368734,
                                 -0.8404223981320295,
                                 -0.8437350285769289,
                                 -0.8470158307408213,
                                 -0.8502646808617548,
                                 -0.8534814563831082,
                                 -0.8566660359582126,
                                 -0.8598182994549292,
                                 -0.8629381279601809,
                                 -0.8660254037844384,
                                 -0.8690800104661598,
                                 -0.8721018327761836,
                                 -0.8750907567220763,
                                 -0.87804666955243,
                                 -0.8809694597611198,
                                 -0.883859017091507,
                                 -0.8867152325405995,
                                 -0.8895379983631634,
                                 -0.8923272080757877,
                                 -0.8950827564609012,
                                 -0.8978045395707417,
                                 -0.9004924547312761,
                                 -0.9031464005460756,
                                 -0.9057662769001394,
                                 -0.9083519849636713,
                                 -0.9109034271958083,
                                 -0.9134205073482999,
                                 -0.9159031304691392,
                                 -0.9183512029061445,
                                 -0.9207646323104914,
                                 -0.9231433276401984,
                                 -0.9254871991635595,
                                 -0.9277961584625301,
                                 -0.9300701184360618,
                                 -0.9323089933033888,
                                 -0.9345126986072632,
                                 -0.9366811512171416,
                                 -0.9388142693323197,
                                 -0.9409119724850201,
                                 -0.9429741815434264,
                                 -0.9450008187146683,
                                 -0.9469918075477572,
                                 -0.9489470729364688,
                                 -0.9508665411221775,
                                 -0.9527501396966384,
                                 -0.9545977976047176,
                                 -0.956409445147075,
                                 -0.958185013982792,
                                 -0.9599244371319493,
                                 -0.9616276489781547,
                                 -0.9632945852710172,
                                 -0.9649251831285718,
                                 -0.9665193810396508,
                                 -0.9680771188662043,
                                 -0.9695983378455693,
                                 -0.9710829805926856,
                                 -0.9725309911022617,
                                 -0.9739423147508862,
                                 -0.9753168982990893,
                                 -0.9766546898933506,
                                 -0.9779556390680555,
                                 -0.9792196967473991,
                                 -0.9804468152472362,
                                 -0.9816369482768823,
                                 -0.9827900509408579,
                                 -0.9839060797405832,
                                 -0.9849849925760183,
                                 -0.9860267487472519,
                                 -0.9870313089560362,
                                 -0.9879986353072698,
                                 -0.9889286913104265,
                                 -0.9898214418809327,
                                 -0.9906768533414904,
                                 -0.9914948934233475,
                                 -0.9922755312675157,
                                 -0.9930187374259336,
                                 -0.9937244838625786,
                                 -0.994392743954524,
                                 -0.9950234924929431,
                                 -0.9956167056840606,
                                 -0.9961723611500499,
                                 -0.9966904379298773,
                                 -0.997170916480093,
                                 -0.9976137786755678,
                                 -0.9980190078101772,
                                 -0.9983865885974316,
                                 -0.9987165071710528,
                                 -0.9990087510854974,
                                 -0.9992633093164255,
                                 -0.9994801722611178,
                                 -0.9996593317388369,
                                 -0.9998007809911359,
                                 -0.9999045146821139,
                                 -0.9999705288986172,
                                 -0.999998821150386,
                                 -0.9999893903701498,
                                 -0.9999422369136666,
                                 -0.9998573625597098,
                                 -0.9997347705100013,
                                 -0.9995744653890902,
                                 -0.9993764532441789,
                                 -0.9991407415448947,
                                 -0.998867339183008,
                                 -0.998556256472097,
                                 -0.9982075051471587,
                                 -0.997821098364166,
                                 -0.9973970506995714,
                                 -0.9969353781497574,
                                 -0.996436098130433,
                                 -0.9958992294759765,
                                 -0.9953247924387252,
                                 -0.9947128086882113,
                                 -0.9940633013103448,
                                 -0.9933762948065422,
                                 -0.9926518150928022,
                                 -0.9918898894987285,
                                 -0.9910905467664987,
                                 -0.9902538170497795,
                                 -0.9893797319125902,
                                 -0.9884683243281114,
                                 -0.9875196286774409,
                                 -0.9865336807482975,
                                 -0.98551051773367,
                                 -0.9844501782304154,
                                 -0.9833527022378017,
                                 -0.9822181311559997,
                                 -0.9810465077845208,
                                 -0.9798378763206036,
                                 -0.9785922823575449,
                                 -0.9773097728829813,
                                 -0.9759903962771154,
                                 -0.974634202310892,
                                 -0.9732412421441199,
                                 -0.9718115683235419,
                                 -0.9703452347808526,
                                 -0.9688422968306648,
                                 -0.9673028111684215,
                                 -0.9657268358682582,
                                 -0.9641144303808117,
                                 -0.9624656555309774,
                                 -0.960780573515615,
                                 -0.9590592479012022,
                                 -0.9573017436214371,
                                 -0.9555081269747874,
                                 -0.9536784656219918,
                                 -0.9518128285835051,
                                 -0.949911286236896,
                                 -0.9479739103141918,
                                 -0.9460007738991726,
                                 -0.9439919514246143,
                                 -0.9419475186694808,
                                 -0.9398675527560649,
                                 -0.9377521321470804,
                                 -0.9356013366427005,
                                 -0.9334152473775484,
                                 -0.9311939468176367,
                                 -0.9289375187572562,
                                 -0.9266460483158152,
                                 -0.9243196219346286,
                                 -0.921958327373656,
                                 -0.9195622537081937,
                                 -0.9171314913255113,
                                 -0.9146661319214441,
                                 -0.9121662684969335,
                                 -0.9096319953545186,
                                 -0.9070634080947788,
                                 -0.9044606036127281,
                                 -0.9018236800941583,
                                 -0.8991527370119378,
                                 -0.8964478751222564,
                                 -0.8937091964608261,
                                 -0.8909368043390314,
                                 -0.8881308033400324,
                                 -0.8852912993148192,
                                 -0.8824183993782194,
                                 -0.8795122119048566,
                                 -0.8765728465250641,
                                 -0.8736004141207462,
                                 -0.8705950268211979,
                                 -0.8675567979988743,
                                 -0.8644858422651134,
                                 -0.8613822754658133,
                                 -0.8582462146770616,
                                 -0.8550777782007195,
                                 -0.851877085559958,
                                 -0.848644257494751,
                                 -0.8453794159573187,
                                 -0.8420826841075277,
                                 -0.8387541863082463,
                                 -0.835394048120651,
                                 -0.8320023962994918,
                                 -0.8285793587883097,
                                 -0.82512506471461,
                                 -0.8216396443849933,
                                 -0.8181232292802365,
                                 -0.8145759520503359,
                                 -0.8109979465095014,
                                 -0.8073893476311098,
                                 -0.8037502915426125,
                                 -0.8000809155204006,
                                 -0.7963813579846259,
                                 -0.7926517584939814,
                                 -0.7888922577404333,
                                 -0.7851029975439159,
                                 -0.7812841208469816,
                                 -0.7774357717094079,
                                 -0.7735580953027638,
                                 -0.7696512379049327,
                                 -0.7657153468945948,
                                 -0.7617505707456683,
                                 -0.7577570590217069,
                                 -0.7537349623702586,
                                 -0.7496844325171831,
                                 -0.7456056222609276,
                                 -0.7414986854667636,
                                 -0.7373637770609816,
                                 -0.7332010530250472,
                                 -0.7290106703897187,
                                 -0.72479278722912,
                                 -0.7205475626547804,
                                 -0.7162751568096308,
                                 -0.7119757308619639,
                                 -0.7076494469993533,
                                 -0.7032964684225362,
                                 -0.6989169593392565,
                                 -0.6945110849580691,
                                 -0.690079011482112,
                                 -0.6856209061028311,
                                 -0.6811369369936764,
                                 -0.6766272733037577,
                                 -0.6720920851514631,
                                 -0.6675315436180422,
                                 -0.662945820741152,
                                 -0.6583350895083666,
                                 -0.6536995238506543,
                                 -0.6490392986358122,
                                 -0.6443545896618724,
                                 -0.6396455736504699,
                                 -0.6349124282401757,
                                 -0.6301553319797962,
                                 -0.6253744643216373,
                                 -0.6205700056147349,
                                 -0.6157421370980531,
                                 -0.6108910408936449,
                                 -0.6060168999997831,
                                 -0.6011198982840578,
                                 -0.5962002204764387,
                                 -0.5912580521623083,
                                 -0.5862935797754599,
                                 -0.5813069905910642,
                                 -0.5762984727186076,
                                 -0.5712682150947924,
                                 -0.5662164074764114,
                                 -0.56114324043319,
                                 -0.5560489053405963,
                                 -0.5509335943726227,
                                 -0.5457975004945359,
                                 -0.5406408174555974,
                                 -0.5354637397817574,
                                 -0.5302664627683121,
                                 -0.5250491824725397,
                                 -0.5198120957063039,
                                 -0.5145554000286292,
                                 -0.5092792937382485,
                                 -0.5039839758661232,
                                 -0.4986696461679334,
                                 -0.4933365051165462,
                                 -0.4879847538944487,
                                 -0.4826145943861614,
                                 -0.4772262291706222,
                                 -0.4718198615135443,
                                 -0.466395695359748,
                                 -0.4609539353254682,
                                 -0.4554947866906346,
                                 -0.4500184553911281,
                                 -0.4445251480110146,
                                 -0.4390150717747475,
                                 -0.4334884345393543,
                                 -0.427945444786594,
                                 -0.422386311615093,
                                 -0.416811244732457,
                                 -0.4112204544473603,
                                 -0.4056141516616116,
                                 -0.3999925478622013,
                                 -0.3943558551133187,
                                 -0.3887042860483553,
                                 -0.3830380538618832,
                                 -0.3773573723016125,
                                 -0.3716624556603281,
                                 -0.3659535187678059,
                                 -0.3602307769827082,
                                 -0.3544944461844626,
                                 -0.3487447427651137,
                                 -0.3429818836211633,
                                 -0.3372060861453874,
                                 -0.3314175682186362,
                                 -0.3256165482016139,
                                 -0.3198032449266424,
                                 -0.3139778776894047,
                                 -0.3081406662406763,
                                 -0.3022918307780303,
                                 -0.2964315919375342,
                                 -0.2905601707854258,
                                 -0.2846777888097743,
                                 -0.2787846679121249,
                                 -0.2728810303991278,
                                 -0.2669670989741516,
                                 -0.2610430967288853,
                                 -0.2551092471349178,
                                 -0.2491657740353113,
                                 -0.243212901636156,
                                 -0.2372508544981125,
                                 -0.231279857527941,
                                 -0.225300135970017,
                                 -0.2193119153978339,
                                 -0.2133154217054936,
                                 -0.2073108810991878,
                                 -0.2012985200886603,
                                 -0.1952785654786652,
                                 -0.1892512443604106,
                                 -0.1832167841029921,
                                 -0.1771754123448154,
                                 -0.1711273569850093,
                                 -0.1650728461748278,
                                 -0.1590121083090471,
                                 -0.1529453720173442,
                                 -0.1468728661556762,
                                 -0.1407948197976461,
                                 -0.1347114622258615,
                                 -0.1286230229232853,
                                 -0.122529731564579,
                                 -0.1164318180074375,
                                 -0.1103295122839221,
                                 -0.1042230445917774,
                                 -0.09811264528575113,
                                 -0.09199854486890356,
                                 -0.08588097398391234,
                                 -0.07976016340437178,
                                 -0.07363634402608747,
                                 -0.06750974685836525,
                                 -0.06138060301530036,
                                 -0.05524914370705387,
                                 -0.04911560023113414,
                                 -0.04298020396367078,
                                 -0.0368431863506864,
                                 -0.03070477889936574,
                                 -0.0245652131693225,
                                 -0.01842472076386337,
                                 -0.01228353332125473,
                                 -0.006141882505979222,
                                 -2.449293598294706e-16};

// ---------------------------------------------------------------------------------------------------------------------
SineUnit::SineUnit() {
    _phase = 0;
    _phaseDelta = 0;
    _pitch = 69.0;
}

// ---------------------------------------------------------------------------------------------------------------------
int SineUnit::renderInput(UInt32 inNumberFrames, GraphSampleType* ioData[2], UInt32 stride) {
    GraphSampleType* outA = ioData[0];
    GraphSampleType* outB = ioData[1];

    UInt32 frame;
    float phase = _phase;
    float phaseDelta = _phaseDelta;
    for (frame = 0; frame < inNumberFrames; ++frame) {
        if (_phaseDelta > 0.0f) {
            GraphSampleType value = g_sineData[(size_t)phase] * _velocity;
            phase = fmodf(phase + phaseDelta, 1024.0f);

            *outA += value;
            *outB += value;
        }

        outA += stride;
        outB += stride;
    }
    _phase = phase;
    return 0;
}

// ---------------------------------------------------------------------------------------------------------------------
void SineUnit::noteOn(float pitch, float velocity) {
    _phaseDelta = SINE_RATE_FOR_PITCH(69, pitch) * 440.0f * 1024.0f / GRAPH_SAMPLE_RATE;
    _velocity = velocity;
    _pitch = pitch;
}

// ---------------------------------------------------------------------------------------------------------------------
void SineUnit::noteOff() { _phaseDelta = 0.0f; }
